## **170120 - 파일읽기와 쓰기**
####**파일 읽기와 쓰기를 활용한 게시판 확장**
***

 오늘은 어제에 이어서 텍스트 파일을 로드하는 방법과 저장하는 방법에 대해서 배워보려고 한다. 
 * 나머지 내용은 내일 업데이트됩니다.

***
###**게시판 메인 코드**
***
	package com.leeyounkyu.bbs;
	
	import java.io.IOException;
	import java.nio.charset.StandardCharsets;
	import java.nio.file.Files;
	import java.nio.file.Path;
	import java.nio.file.Paths;
	import java.util.ArrayList;
	import java.util.Scanner;
	
	public class MainBbs {
	
		public static void main(String[] args) throws IOException {
			
			MainBbs maa = new MainBbs();
			maa.runn();
			
		}	
		
		public void runn() throws IOException {
			
			BbsController bc = new BbsController();
			Scanner scanner = new Scanner(System.in);
			boolean run = true;
			String command = "";
			while(run) {		
				print("명령어를 입력하세요. 나가려면 q를 눌러주세요");
				command = scanner.nextLine();
				if(command.equals("create")) {
					create(scanner, bc);
				}
				else if(command.equals("q")) 
					run = false;	
				else if(command.equals("read")) {
					read(scanner, bc );
				}
				else if(command.equals("delete")) {
					// delete(scanner, bc);
				}
				else if(command.equals("update")) {
					update(scanner, bc);
				}
				else if(command.equals("list")) {
					readAll(scanner, bc);		
				}
			}
			
	
			
		}
		
		public void create(Scanner scanner, BbsController bc) {
			
			Bbs bbs = new Bbs(); //Bbs 객체를 신규로 생성하고
			write(scanner, bbs); // write 함수에서 입력한 후
			
			
			try {
				bc.create(bbs);
			} catch (IOException e) {
				// TODO Auto-generated catch block
				System.out.println("죄송");
				e.printStackTrace();
			} // control을 이용해 arraylist에 add한다.
			
	
			
		}
		
		
		public void read(Scanner scanner, BbsController bc ) throws IOException {
			print("글번호를 입력하세요 : ");
			String bno = scanner.nextLine();
			Path path = Paths.get("C:/input","data.txt");
					
					
			byte rowData[] = Files.readAllBytes(path);
						
			String content = new String(rowData, StandardCharsets.UTF_8);
			int i = Integer.parseInt(bno);
			int ab = content.indexOf("글번호 :" + i);
			int abc = content.indexOf("글끝" + i);
			String cat = content.substring(ab, abc);
			String splitcat = cat.replace("$%$","\n");
			System.out.println(splitcat);
						
		}
		
		
		public void readAll(Scanner scanner, BbsController bc) {
			
			Path path = Paths.get("C:/input","data.txt");
					
					try {
						byte rowData[] = Files.readAllBytes(path);
						
						String content = new String(rowData, StandardCharsets.UTF_8);
						String[] contentar = content.split("뷁");
						for(int i = 0 ; i < contentar.length ; i ++) {
							if( i%5 == 0 || i%5 == 1 ) {
								System.out.println(contentar[i]);
	
							}
						}
					
						
						
					} catch (IOException e) {
						e.printStackTrace();
					}
		}
		
		public void print(String value) {
			
			System.out.println(value);
			
		}
		
		public void update(Scanner scanner, BbsController bc) {
		/*	print("수정할 글번호를 입력하세요");
			String number = scanner.nextLine(); 
			int num = Integer.parseInt(number);
			// Bbs bbs = bc.read(num); //ArrayList에서 Bbs객체를 하나 가져와서
			                       // write 함수에서 재입력한다.
									//  bc를 통한 update는 필요하지 않다.
			
			write(scanner, bbs);
			bbs.setDateTime(Util.getDatatime());
		
		*/
		}
		public void write(Scanner scanner, Bbs bbs) {
			
			print("제목을 입력하세요");
			bbs.setTitle(scanner.nextLine());
			print("작성자를 입력하세요");
			bbs.setAuthor(scanner.nextLine());
			print("내용을 입력하세요. 다치면 q를 눌러주세요");
			boolean na0 = true;
			String ka = "";
			while(na0) {
				String na = "";
				na = scanner.nextLine();
				if(!(na.equals("q"))) {
					
					ka = ka  + na + "\n";
					
				}
				else {
					bbs.setContent(ka);
					na0 = false;
				}
			
			
			}
			
			
		}
		
	}
	
	
***
####게시판 FileUtil 코드
***
	package com.leeyounkyu.bbs;
	
	import java.io.BufferedReader;
	import java.io.BufferedWriter;
	import java.io.File;
	import java.io.FileInputStream;
	import java.io.FileNotFoundException;
	import java.io.FileOutputStream;
	import java.io.FileReader;
	import java.io.FileWriter;
	import java.io.IOException;
	import java.io.InputStreamReader;
	import java.nio.charset.StandardCharsets;
	import java.nio.file.Files;
	import java.nio.file.Path;
	import java.nio.file.Paths;
	import java.nio.file.StandardOpenOption;
	
	public class FileUtil {
	
		private static final String FILEROOT = "C:" + File.separator;
	
		
		public void readStream() {
			String directory = "input" + File.separator;
			String filename = FILEROOT+ directory +"text.txt";
			// 1. 유효성검사를 위해 파일 인스턴스 생성
			File file = new File(filename);
			
			// 2.파일이 있으면
			if(file.exists()) {
				// 3. 파일을 읽기 위한 Stream instance 생성
			
				
				try (BufferedReader br = new BufferedReader(new InputStreamReader
						(new FileInputStream(filename),"EUC-KR"))) {
					// 4. 반복문을 돌면서 최소단위로 파일 읽기			
					String line;
					while((line = br.readLine()) != null){
							System.out.print(line);	
					}
				} catch (FileNotFoundException e){
					e.printStackTrace();
				}catch (IOException e) {
					
					e.printStackTrace();
				} 
			} else {
				System.out.println("파일이 없습니다.");
			}
		}
		
		
		
		public void writeStream() {
			String directory = "input" + File.separator;
			String filename = "test.txt";
			
			File dir = new File(FILEROOT + directory);
			if(!dir.exists()) {
				dir.mkdirs();
			}
			
	        File file = new File(FILEROOT + directory + filename);
	        if(file.exists()) {
	        	System.out.println("같은 파일이 존재합니다.");
	        } else {
	        	try( FileOutputStream fos = new FileOutputStream(FILEROOT + directory + filename)) {
	        		String content = "작성내용입니다다.";
	        		fos.write(content.getBytes());
	        	
	        	} catch (IOException e) {
				
					e.printStackTrace();
				}
	        }
		}
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		public void writeFile() {
			
			String directory = "input/";
			String filename = "text.txt";
			
			File dir = new File(FILEROOT + directory);
			if(!dir.exists()) {
				dir.mkdirs();
			}
			
	        File file = new File(FILEROOT + directory + filename);
	        if(file.exists()) {
	        	System.out.println("같은 파일이 존재합니다.");
	        } else {
	        	try( BufferedWriter bw = new BufferedWriter(new FileWriter(file))) {
	        		String content = "작성내용입니다.";
	        		bw.write(content);
	        		bw.flush();
	        	} catch (IOException e) {
				
					e.printStackTrace();
				}
	        }
		}
		
		
		public void readFile() {
			
			// 1. 파일생성
			File file = new File("C:/Users/USER/Documents/이윤규 코딩/Younkyu/pdf/170113software.md");
	
			// 2. 파일 유효성 체크
			if(file.exists()) {
				try (BufferedReader br = new BufferedReader(new FileReader(file))) {
					// 3. 버퍼를 사용해서 파일을 읽는다.
					
					String line;
					while( (line = br.readLine()) != null) {
						System.out.println(line);
					}
					
				} catch (FileNotFoundException e) {
					e.printStackTrace();
					System.out.println("파일이 없습니다.");
				} catch (IOException e) {
					e.printStackTrace();
					System.out.println("파일이 없습니다.");
				} 
				
			} else {
				System.out.println("파일이 없습니다.");
			}
			
			
		}
		
		
		public static void readNio( ) {
			Path path = Paths.get("C:/input","data.txt");
			
			try {
				byte rowData[] = Files.readAllBytes(path);
				
				String content = new String(rowData, StandardCharsets.UTF_8);
				System.out.print(content);
				
			} catch (IOException e) {
				e.printStackTrace();
			}
		}
		
		public static void writeNio(String jujang) {
			
			String directory = "input/";
			String filename = "data.txt";
			
			File dir = new File(FILEROOT + directory);
			if(!dir.exists()) {
				dir.mkdirs();
			}
			
	        File file = new File(FILEROOT + directory + filename);
			Path path = Paths.get("C:/input","data.txt");
			try {
				Files.write(path, jujang.getBytes(StandardCharsets.UTF_8), StandardOpenOption.CREATE, StandardOpenOption.APPEND);
			} catch (IOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}
		
		
		public static void readNionum(int no) {
			Path path = Paths.get("C:/input","data.txt");
			
			try {
				byte rowData[] = Files.readAllBytes(path);
				
				String content = new String(rowData, StandardCharsets.UTF_8);
				System.out.print(content);
				
			} catch (IOException e) {
				e.printStackTrace();
			}
		}
		
	}

***
###**게시판 컨트롤러 수정**
***
	package com.leeyounkyu.bbs;
	
	import java.io.BufferedReader;
	import java.io.BufferedWriter;
	import java.io.File;
	import java.io.FileInputStream;
	import java.io.FileNotFoundException;
	import java.io.FileOutputStream;
	import java.io.FileReader;
	import java.io.FileWriter;
	import java.io.IOException;
	import java.io.InputStreamReader;
	import java.nio.charset.StandardCharsets;
	import java.nio.file.Files;
	import java.nio.file.Path;
	import java.nio.file.Paths;
	import java.nio.file.StandardOpenOption;
	
	public class FileUtil {
	
		private static final String FILEROOT = "C:" + File.separator;
	
		
		public void readStream() {
			String directory = "input" + File.separator;
			String filename = FILEROOT+ directory +"text.txt";
			// 1. 유효성검사를 위해 파일 인스턴스 생성
			File file = new File(filename);
			
			// 2.파일이 있으면
			if(file.exists()) {
				// 3. 파일을 읽기 위한 Stream instance 생성
			
				
				try (BufferedReader br = new BufferedReader(new InputStreamReader
						(new FileInputStream(filename),"EUC-KR"))) {
					// 4. 반복문을 돌면서 최소단위로 파일 읽기			
					String line;
					while((line = br.readLine()) != null){
							System.out.print(line);	
					}
				} catch (FileNotFoundException e){
					e.printStackTrace();
				}catch (IOException e) {
					
					e.printStackTrace();
				} 
			} else {
				System.out.println("파일이 없습니다.");
			}
		}
		
		
		
		public void writeStream() {
			String directory = "input" + File.separator;
			String filename = "test.txt";
			
			File dir = new File(FILEROOT + directory);
			if(!dir.exists()) {
				dir.mkdirs();
			}
			
	        File file = new File(FILEROOT + directory + filename);
	        if(file.exists()) {
	        	System.out.println("같은 파일이 존재합니다.");
	        } else {
	        	try( FileOutputStream fos = new FileOutputStream(FILEROOT + directory + filename)) {
	        		String content = "작성내용입니다다.";
	        		fos.write(content.getBytes());
	        	
	        	} catch (IOException e) {
				
					e.printStackTrace();
				}
	        }
		}
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		public void writeFile() {
			
			String directory = "input/";
			String filename = "text.txt";
			
			File dir = new File(FILEROOT + directory);
			if(!dir.exists()) {
				dir.mkdirs();
			}
			
	        File file = new File(FILEROOT + directory + filename);
	        if(file.exists()) {
	        	System.out.println("같은 파일이 존재합니다.");
	        } else {
	        	try( BufferedWriter bw = new BufferedWriter(new FileWriter(file))) {
	        		String content = "작성내용입니다.";
	        		bw.write(content);
	        		bw.flush();
	        	} catch (IOException e) {
				
					e.printStackTrace();
				}
	        }
		}
		
		
		public void readFile() {
			
			// 1. 파일생성
			File file = new File("C:/Users/USER/Documents/이윤규 코딩/Younkyu/pdf/170113software.md");
	
			// 2. 파일 유효성 체크
			if(file.exists()) {
				try (BufferedReader br = new BufferedReader(new FileReader(file))) {
					// 3. 버퍼를 사용해서 파일을 읽는다.
					
					String line;
					while( (line = br.readLine()) != null) {
						System.out.println(line);
					}
					
				} catch (FileNotFoundException e) {
					e.printStackTrace();
					System.out.println("파일이 없습니다.");
				} catch (IOException e) {
					e.printStackTrace();
					System.out.println("파일이 없습니다.");
				} 
				
			} else {
				System.out.println("파일이 없습니다.");
			}
			
			
		}
		
		
		public static void readNio( ) {
			Path path = Paths.get("C:/input","data.txt");
			
			try {
				byte rowData[] = Files.readAllBytes(path);
				
				String content = new String(rowData, StandardCharsets.UTF_8);
				System.out.print(content);
				
			} catch (IOException e) {
				e.printStackTrace();
			}
		}
		
		public static void writeNio(String jujang) {
			
			String directory = "input/";
			String filename = "data.txt";
			
			File dir = new File(FILEROOT + directory);
			if(!dir.exists()) {
				dir.mkdirs();
			}
			
	        File file = new File(FILEROOT + directory + filename);
			Path path = Paths.get("C:/input","data.txt");
			try {
				Files.write(path, jujang.getBytes(StandardCharsets.UTF_8), StandardOpenOption.CREATE, StandardOpenOption.APPEND);
			} catch (IOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}
		
		
		public static void readNionum(int no) {
			Path path = Paths.get("C:/input","data.txt");
			
			try {
				byte rowData[] = Files.readAllBytes(path);
				
				String content = new String(rowData, StandardCharsets.UTF_8);
				System.out.print(content);
				
			} catch (IOException e) {
				e.printStackTrace();
			}
		}
		
	}
